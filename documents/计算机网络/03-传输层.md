---
title: 02-应用层
tags: [计算机, 计算机网网络]
authors: leewei
---

## 3.1 概述和传输层服务

```
目标:
- 传输层的工作原理
 - 多路复用 / 解复用
 - 可靠数据传输
 - 流量控制
 - 拥塞控制
- 学习Internet的传输层协议
 - UDP: 无连接传输
 - TCP: 面向连接的可靠性传输
 - TCP的拥塞控制
```

### **传输服务协议**

传输协议运行在端系统

- 发送方：将应用层的报文分成报文段，然后传递给网络层
- 接收方：将报文段重组成报文，然后传递给应用层

有多个传输层协议可供应用选择：

- Internet：TCP 和 UDP

存储转发，尽力而为的服务。

下层传递的服务是不可靠的，但是要向上层传递可靠的服务。TCP加强了可靠性



### 传输层 VS 网络层

网络层服务，主机之间的逻辑通信

传输层服务：进程间的逻辑通信

- 依赖网络层的服务
  - 延时，带宽
- 并对网络层的服务进行增强
  - 数据丢失，顺序混乱、加密



### Internet传输层协议

可靠的，保守的传输：TCP

- 多路复用，解复用
- 拥塞控制
- 流量控制
- 建立连接

不可靠，不保存的传输：UDP

- 多路复用，解复用
- 没有为尽力而为的IP服务添加更多的其他额外服务

都不提供的服务

- 延时保证
- 带宽保证



### 多路复用工作原理

解复用作用:TCP或者UDP实体采用哪些信息，将报文段的数据部分交给正确的socket，从而交给正确的进程

主机收到IP数据报

- 每个数据报都有源IP地址和目标地址
- 每个数据报承载一个传输层报文段
- 每个报文段有一个源端口好和目标端口号（特定应用有著名的端口号）

主机联合使用IP地址和端口号将报文段发给合适的套接字。



## 3.3无连接传输 UDP

### UDP： user Datagram Protocol 

bones Internet 传输协议

尽力而为的服务：报文段可能

- 丢失
- 送到应用进程的报文段乱序

无连接

- UDP发送端和接收端之间没有握手
- 每个UDP报文段都被独立地处理

UDP被用于

- 流媒体：丢失不敏感，速率敏感，应用可控制传输速率
- DNS
- SNMP

在UDP上实现可靠传输

- 在应用层增加可靠性
- 应用特定的差错恢复

### UDP：用户数据报协议

UDP报文段的字节数包括头部

为什么要有UDP？

- 不建议连接（会增加延时）
- 简单：在发送端和接收端没有连接状态
- 报文段的头部很小（开销小）
- 无拥塞控制和流量控制
  - UDP可以尽可能快的发送报文段
  - 应用-> 传输的速率=主机->网络的速率



## 3.4可靠数据传输原理



### 可靠数据传输(rdt)的原理

rdt在应用层,传输层和数据链路层都很重要

是网络Top 10问题

信道的不可靠特点觉定了可靠数据传输协议(rdt)的复杂性



### 可靠数据传输:问题描述

rdt_send():被上层(如应用层)调用，以将数据交付给下方的发送实体。

udt_send: 被rdt调用,用以将分组放到不可靠的信道上传输到接收方.

deliver_data(): 被rdt调用，将数据交付给上层。

udt_rcv(): 当分组通过信道到达接收方式被调用.



- 渐增式地开发可靠数据传输协议(rdt)的发送方和接收方
- 值考虑单向数据传输
  - 但控制信息是双向流动的
- 双向的数据插损胡文艺实际上是2个单向数据传输问题的综合。
- 使用有限状态机（FSM）来描述发送方和接收方

状态： 在该状态时，下一个状态只由下一个时间唯一确定。



### Rdt1.0 在可靠信道上的可靠数据传输

- 下层的信道完全是可靠的
  - 没有比特出错
  - 没有分组丢失
- 发送方和接收方的FSM
  - 发送方将数据发送到下层信道
  - 接收方从下层信道接收数据

### rdt2.0的致命缺陷

如果ACK / NAK出错?

- 发送方不知道接收方发生了什么事
- 发送方如何做
  - 重传可能重复
  - 不重传可能死锁(出错)
- 需要引进新的机制
  - 序号

处理重复

- 发送方在每个分组中加入序号
- 如果ACK / NAK 出错，发送方重传当前分组
- 接收方丢弃（不发给上层，重复分组）



完备协议：发送方发送，一个分组然后等待接受方的应答



### rdt2.1 讨论

- 发送方
  - 在分组中加入序号
  - 两个序号(0, 1)就足够了
    - 一次只发送一个未经确认的分组

- 必须检测ACK / NAK 是否出错(需要EDC)

- 状态数变成了两倍
  - 必须记住当前分组的序号是0还是1

接受方

- 必须检测接收到的分组是否是重复的
  - 状态会只指示希望接收到分组的序号为0或1



**注意:**

接收方并不知道发送发是否正确收到其ACK / NAK 

- 没有安排确认的确认

  
